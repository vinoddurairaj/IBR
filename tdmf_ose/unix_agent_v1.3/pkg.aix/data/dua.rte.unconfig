#!/bin/sh

# rc related files this script touches
PKGNAME=dua
rcdir=/etc
rcfil=rc

# Pre uninstall process.

/etc/dua/init.d/SFTKdua stop

# chk whether already done

installed=0;
cat ${rcdir}/${rcfil} |\
sed -n -e '/@@@ Replicator Agent START RC + @@@/,/@@@ Replicator Agent START RC - @@@/p' |\
egrep "(^/etc/$PKGNAME/init.d/SFTKdua)" 1> /dev/null 2>&1
if [ $? -eq 0 ]
then
	installed=1;
else
	echo "$0: Replicator Agent service is not installed";
	exit 1
fi

if [ ${installed} -eq 1 ]
then

# chk for the context to be modified 
lnum=`cat ${rcdir}/${rcfil} | sed -n -e '/^# @@@ Replicator Agent START RC + @@@/='`
if [ xx"${lnum}" = "xx" ]
then
	echo "$0: context to modify not found";
	exit 1;
fi
endlnum=`expr ${lnum} + 3`

# line preceding this address
lnum=`expr ${lnum} - 1`
startline=`cat ${rcdir}/${rcfil} | awk 'NR == '${lnum}' {print $0}'`
if [ "${startline}" != "" ]
then
	lnum=`expr ${lnum} + 1`
fi
echo "$0: deleting Replicator Agent service at line ${lnum} of ${rcdir}/${rcfil}"

endlnum=`expr ${endlnum} + 1`
endline=`cat ${rcdir}/${rcfil} | awk 'NR == '${endlnum}' {print $0}'`
if [ "${endline}" != "" ]
then
	endlnum=`expr ${endlnum} - 1`
fi

ed ${rcdir}/${rcfil} 1> /dev/null 2>&1 << EOSEDCMD
${lnum},${endlnum}d
w
q
EOSEDCMD

fi

exit 0;
