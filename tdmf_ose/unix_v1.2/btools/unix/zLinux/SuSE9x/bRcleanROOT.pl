#!/usr/bin/perl -I../../../pms -I../../..
#############################################
###########################################
#
#  perl -c bRcleanROOT.pl
#
#    clean tmp build files as result of make  : 
#
#        /var/tmp 
#        /usr/tmp (appears to be ln to /var/tmp) 
# 
###########################################
#############################################

#############################################
###########################################
#  vars  /  pms  /  use
###########################################
#############################################

eval 'require bRglobalvars';

our $COMver;
our $RFXver;
our $TUIPver;
our $Bbnum;
our $buildnumber;

our $sbnum="$buildnumber";
our $tarTARG="/work/builds/$Bbnum/SuSE9x/$COMver.rootVARtmp.$Bbnum.tar";

#############################################
###########################################
#  STDOUT  /  STDOUT
###########################################
#############################################

open (STDOUT,">cleanroot.txt");
open (STDERR,">&STDOUT");

#############################################
###########################################
#  strip build number leading zero(s) 
###########################################
#############################################

if ($sbnum =~ /^0000[1-9]/ ) {
   $sbnum =~ s/0000//;
}
elsif ($sbnum =~ /^000[1-9]/ ) {
   $sbnum =~ s/000//;
}
elsif ($sbnum =~ /^00[1-9]/ ) {
   $sbnum =~ s/00//;
}
elsif ($sbnum =~ /^0[1-9]/ ) {
   $sbnum =~ s/0//;
}
chomp ($sbnum);

#############################################
###########################################
#  exec statements
###########################################
#############################################

print "\n\nSTART  :  bRcleanROOT.pl\n\n";

#############################################
###########################################
#  log values 
###########################################
#############################################

print "\n\nCOMver          =   $COMver\n";
print "\nRFXver          =   $RFXver\n";
print "\nTUIPver         =   $TUIPver\n";
print "\nBbnum           =   $Bbnum\n";
print "\nbuildnumber     =   $buildnumber\n";
print "\nsbnum           =   $sbnum\n\n";
print "\ntarTARG         =   $tarTARG\n\n";

system qq(uname -a);
print "\n\n";
system qq(date);
print "\n\n";

#############################################
###########################################
#  establish PWD 
###########################################
#############################################

$CWD=`pwd`;
print "\nCWD          =   $CWD\n\n";
chomp($CWD);

#############################################
###########################################
#  cd /work/tmp 
###########################################
#############################################

chdir "/var/tmp"  || die "chdir /var/tmp death  :  $!\n";
system qq(pwd);
print "\n\n";

#############################################
###########################################
#  capture /var/tmp/dtc-$sbnum-buildroot/*
###########################################
#############################################

print "\n$COMver zLinux capture /var/tmp/dtc-$sbnum-buildroot/*\n\n";

if (-e "/work/builds/$Bbnum/SuSE9x" && -e "dtc-$sbnum-buildroot") {
   system qq(sudo tar cvf $tarTARG dtc-$sbnum-buildroot/* );
}

print "\n\n";

#############################################
###########################################
#  rm -rf /var/tmp/dtc-$sbnum-buildroot/*
###########################################
#############################################

if (-e "dtc-$sbnum-buildroot") {
   system qq(sudo rm -rf dtc-$sbnum-buildroot );
}

#############################################
###########################################
#  rm -rf /usr/tmp/dtc-$sbnum-buildroot/*
###########################################
#############################################

if (-e "/usr/tmp/dtc-$sbnum-buildroot") {
   chdir "/usr/tmp";
   system qq(pwd);
   system qq(sudo rm -rf dtc-$sbnum-buildroot );
}

#############################################
###########################################
#  return $CWD 
###########################################
#############################################

chdir "$CWD";
system qq(pwd);

#############################################
#############################################

print "\n\nEND  :  bRcleanROOT.pl\n\n";

#############################################
#############################################

close (STDERR);
close (STDOUT);

